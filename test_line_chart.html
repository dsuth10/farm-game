<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Chart Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="chart-container" id="profitChart">
        <!-- Chart will be rendered here -->
    </div>

    <script>
        // Mock game state for testing
        const mockGameState = {
            settings: { startingBalance: 200 },
            roundHistory: [
                { season: 'spring', finalProfit: 50 },
                { season: 'summer', finalProfit: 75 },
                { season: 'autumn', finalProfit: 30 },
                { season: 'winter', finalProfit: -20 }
            ]
        };

        // Mock the createMoneyLineChart function
        function createMoneyLineChart() {
            // Calculate money at end of each round
            const moneyAtEndOfRounds = [];
            let runningBalance = mockGameState.settings.startingBalance || 200;
            
            // Add starting balance as first point
            moneyAtEndOfRounds.push({
                round: 0,
                season: 'start',
                money: runningBalance
            });
            
            // Add money at end of each completed round
            mockGameState.roundHistory.forEach((round, index) => {
                runningBalance += round.finalProfit;
                moneyAtEndOfRounds.push({
                    round: index + 1,
                    season: round.season,
                    money: runningBalance
                });
            });
            
            // Create SVG line chart with improved dark theme
            const chartWidth = 400;
            const chartHeight = 200;
            const legendHeight = 30; // Space for legend below
            const totalHeight = chartHeight + legendHeight;
            const padding = 40;
            const plotWidth = chartWidth - 2 * padding;
            const plotHeight = chartHeight - 2 * padding;
            
            // Find min and max values for scaling
            const minMoney = Math.min(...moneyAtEndOfRounds.map(d => d.money));
            const maxMoney = Math.max(...moneyAtEndOfRounds.map(d => d.money));
            const moneyRange = maxMoney - minMoney;
            
            // Create SVG with dark theme and space for legend
            let svg = `<svg width="${chartWidth}" height="${totalHeight}" class="money-line-chart">`;
            
            // Add dark chart background (only for the chart area)
            svg += `<rect x="0" y="0" width="${chartWidth}" height="${chartHeight}" fill="#1a1a1a" stroke="none"/>`;
            
            // Add chart title with light text
            svg += `<text x="${chartWidth/2}" y="15" text-anchor="middle" class="chart-title" fill="#ffffff">Money Trend</text>`;
            
            // Add Y-axis label with light text
            svg += `<text x="10" y="${chartHeight/2}" text-anchor="middle" transform="rotate(-90, 10, ${chartHeight/2})" class="axis-label" fill="#cccccc">Money ($)</text>`;
            
            // Draw Y-axis grid lines and labels with subtle styling
            const yTicks = 5;
            for (let i = 0; i <= yTicks; i++) {
                const y = padding + (i / yTicks) * plotHeight;
                const moneyValue = maxMoney - (i / yTicks) * moneyRange;
                const moneyLabel = Math.round(moneyValue);
                
                // Subtle grid line
                svg += `<line x1="${padding}" y1="${y}" x2="${chartWidth-padding}" y2="${y}" stroke="#404040" stroke-width="0.5"/>`;
                // Y-axis label with light color
                svg += `<text x="${padding-5}" y="${y+3}" text-anchor="end" class="tick-label" fill="#cccccc">$${moneyLabel}</text>`;
            }
            
            // Draw X-axis grid lines and labels
            moneyAtEndOfRounds.forEach((dataPoint, index) => {
                const x = padding + (index / (moneyAtEndOfRounds.length - 1)) * plotWidth;
                
                // Subtle grid line
                svg += `<line x1="${x}" y1="${padding}" x2="${x}" y2="${chartHeight-padding}" stroke="#404040" stroke-width="0.5"/>`;
                
                // X-axis label (season or "Start") with light color
                const label = dataPoint.round === 0 ? 'Start' : dataPoint.season.charAt(0).toUpperCase() + dataPoint.season.slice(1);
                svg += `<text x="${x}" y="${chartHeight-padding+15}" text-anchor="middle" class="tick-label" fill="#cccccc">${label}</text>`;
            });
            
            // Draw the line with light color and glow effect
            let pathData = '';
            moneyAtEndOfRounds.forEach((dataPoint, index) => {
                const x = padding + (index / (moneyAtEndOfRounds.length - 1)) * plotWidth;
                const y = padding + ((maxMoney - dataPoint.money) / moneyRange) * plotHeight;
                
                if (index === 0) {
                    pathData += `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
            });
            
            // Add glow effect and light line color
            svg += `<defs>
                <filter id="glow">
                    <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                    <feMerge> 
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>`;
            
            svg += `<path d="${pathData}" stroke="#4a90e2" stroke-width="3" fill="none" filter="url(#glow)"/>`;
            
            // Draw data points with improved styling
            moneyAtEndOfRounds.forEach((dataPoint, index) => {
                const x = padding + (index / (moneyAtEndOfRounds.length - 1)) * plotWidth;
                const y = padding + ((maxMoney - dataPoint.money) / moneyRange) * plotHeight;
                
                // Add subtle glow for data points
                svg += `<circle cx="${x}" cy="${y}" r="5" fill="rgba(74, 144, 226, 0.3)" stroke="none"/>`;
                svg += `<circle cx="${x}" cy="${y}" r="4" fill="${getSeasonColor(dataPoint.season)}" stroke="#ffffff" stroke-width="2"/>`;
                
                // Add tooltip with money value
                svg += `<title>Round ${dataPoint.round}: $${dataPoint.money}</title>`;
            });
            
            // Add legend below the chart as SVG elements
            const seasons = ['start', 'spring', 'summer', 'autumn', 'winter'];
            const seasonLabels = ['Start', 'Spring', 'Summer', 'Autumn', 'Winter'];
            const legendY = chartHeight + 20; // Position below chart
            const legendStartX = 50;
            const legendSpacing = 70;
            
            seasons.forEach((season, index) => {
                const legendX = legendStartX + (index * legendSpacing);
                
                // Legend color circle
                svg += `<circle cx="${legendX}" cy="${legendY}" r="4" fill="${getSeasonColor(season)}" stroke="#ffffff" stroke-width="1"/>`;
                
                // Legend label
                svg += `<text x="${legendX + 8}" y="${legendY + 3}" class="legend-label-compact" fill="#cccccc" font-size="12">${seasonLabels[index]}</text>`;
            });
            
            svg += '</svg>';
            
            return svg;
        }

        function getSeasonColor(season) {
            const colors = {
                'start': '#6c757d',
                'spring': '#28a745',
                'summer': '#ffc107',
                'autumn': '#fd7e14',
                'winter': '#17a2b8'
            };
            return colors[season] || '#6c757d';
        }

        // Test the chart
        document.addEventListener('DOMContentLoaded', () => {
            const chartContainer = document.getElementById('profitChart');
            chartContainer.innerHTML = createMoneyLineChart();
        });
    </script>
</body>
</html> 